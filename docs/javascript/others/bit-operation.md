---
title: 位运算
date: 2020-07-26 19:42:24
---

| 符号             | 描述                                                                           | 常见应用                                               | 类似                |
| ---------------- | ------------------------------------------------------------------------------ | ------------------------------------------------------ | ------------------- |
| 按位与 `&`       | 只有两个数的值为 1 时，才返回 1                                                | 奇偶数的判断 <br /> `1 & 3 === 1` <br /> `1 & 2 === 0` |
| 按位或 `|`       | 只要两个数中有一个数为 1，结果就为 1                                           | 浮点数向下求整 <br /> `1.1 | 0 === 1`                  | `Math.floor`        |
| 按位非 `~`       | 二进制的反码                                                                   |
| 按位异或 `^`     | 两个数中只有一个 1 时返回 1，其他情况返回 0                                    |
| 有符号左移 `<<`  | 32 位二进制数的所有位向左移动指定位数                                          | 2 的 n 次方 <br /> `1 << n`                            | `Math.pow(2, n)`    |
| 有符号右移 `>>`  | 32 位二进制数的所有位向右移动指定位数                                          | 求一个数的二分之一 <br /> `n >> 1`                     | `Math.floor(n) / 2` |
| 无符号右移 `>>>` | 正数的无符号右移与有符号右移结果是一样的，负数的无符号右移会把符号位也一起移动 | 判断一个数的正负 <br /> `n === n >>> 0`                | `n > 0`             |
| `~~`             |                                                                                | 取整                                                   | `Math.floor`        |

## 按位与(&)

`&&` 运算符我们都知道，只有两个都为真，结果才为真。`&` 道理是一样的，只有两个数的值为 1 时，才返回 1。例如 1 和 3 的按位与操作：

```YML
      0001
    & 0011
  ---------
      0001
```

也即 `1 & 3 === 1`, `1 & 2 === 0`，故可以用来做奇偶数的判断

```js
function judge(num) {
  if (num % 2 === 0) {
    console.log(`${num} 是个偶数`)
  } else {
    console.log(`${num} 是个奇数`)
  }
}

// ==== 使用位运算 更快更好
function judge(num) {
  if ((1 & num) === 0) {
    console.log(`${num} 是个偶数`)
  } else {
    console.log(`${num} 是个奇数`)
  }
}
```

下面是位运算过程：

```YML
1 = 0001         |         1 = 0001
3 = 0011         |         2 = 0010
--------         |         --------
& = 0001         |         & = 0000
```

奇数的二进制码的最后一位数肯定是 1，而 1 只有最后一位为 1，按位 `&` 操作之后，结果肯定只有最后一位数为 1。而偶数的二进制表示的最后一位数是 0，和 1 进行按位&操作，结果所有位数都为 0。

## 按位或(|)

`|` 与 `||` 操作符的道理也是一样的，只要两个数中有一个数为 1，结果就为 1。

```YML
   0001
|  0011
---------
   0011
```

对浮点数向下求整，我们会用：`var num = Math.floor(1.1); // 1`

我们也可以用位运算来求整：`var num = 1.1 | 0 // 1`

其实浮点数是不支持位运算的，所以会先把 `1.1` 转成整数 `1` 再进行位运算，就好像是对浮点数向下求整。所以 `1|0` 的结果就是 1。

## 按位非(~)

按位非就是求二进制的反码：

```JS
var num = 1     // 二进制 00000000000000000000000000000001
var num1 = ~num // 二进制 11111111111111111111111111111110
```

## 按位异或(^)

按位异或是两个数中只有一个 1 时返回 1，其他情况返回 0。

```YML
   0001
^  0011
---------
   0010
```

数字与数字本身按位异或操作得到的是 0，因为每两个对应的数字都相同，所以最后返回的都是 0。

## 有符号左移(<<)

有符号左移会将 32 位二进制数的所有位向左移动指定位数。如：

```JS
var num = 2     // 二进制10
num = num << 5  // 二进制1000000，十进制64
```

如果要求 2 的 n 次方，可以这样：

```js
function power(n) {
  return 1 << n
}

power(5) // 32
```

1 的二进制是 01，左移 5 位就是 0100000，十进制就是 2 的 5 次方 32。

## 有符号右移(>>)

有符号右移会将 32 位二进制数的所有位向右移动指定位数。如：

```JS
var num = 64   // 二进制1000000
num = num >> 5 // 二进制10，十进制2
```

求一个数的二分之一：

```js
var num = 64 >> 1 // 32 1000000 -> 10000
```

<span class='orange'>有符号左移与右移不会影响符号位。</span>

## 无符号右移(>>>)

正数的无符号右移与有符号右移结果是一样的。负数的无符号右移会把符号位也一起移动，而且无符号右移会把负数的二进制码当成正数的二进制码：

```JS
var num = -64   // 11111111111111111111111111000000
num = num >>> 5 // 134217726
```

所以，我们可以利用无符号右移来判断一个数的正负：

```js
function isPos(n) {
  return n === n >>> 0
}

isPos(-1) // false
isPos(1) // true
```

-1>>>0 虽然没有向右移动位数，但-1 的二进制码已经变成了正数的二进制码：

`11111111111111111111111111111111`

所以-1>>>0 的值为 4294967295。

~~用来取整

```js
~~3.5   3

~~-2.6  -2
```

---

参考 [js 中的位运算](https://www.cnblogs.com/ckAng/p/9996699.html)
