---
title: SSR & CSR
date: 2020-07-09 10:39:33
---

## 概念

先来认识一些概念：

| 名词      | 描述                                                                                                                                                                                                                                    |
| --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SEO       | 搜索引擎优化（Search Engine Optimization）。是一种利用搜索引擎规则，提高网站在搜索引擎内自然排名的技术。对大多数搜索引擎，不识别 JavaScript 内容，只识别 HTML 内容                                                                      |
| SPA       | 单页面应用（single page application）。动态重写当前的页面来与用户交互，而不需要重新加载整个页面。单页应用做到了前后端分离，后端只负责处理数据提供接口，页面逻辑和页面渲染都交给了前端。**CSR、SSR、Prerender 都是基于 SPA**。           |
| CSR       | 客户端渲染(Client Side Render)。渲染过程全部交给浏览器进行处理，服务器不参与任何渲染。页面初始加载的 HTML 文档中无内容，需要下载执行 JS 文件，由浏览器动态生成页面，并通过 JS 进行页面交互事件与状态管理。                              |
| SSR       | 服务端渲染(Server Side Render)。DOM 树在服务端生成，而后返回给前端。即当前页面的内容是服务器生成好一次性给到浏览器的进行渲染的。                                                                                                        |
| Prerender | 预渲染。打包的阶段就预先渲染页面，所以在请求到 index.html 时 就已经是渲染过的内容。                                                                                                                                                     |
| 同构      | 客户端渲染和服务器端渲染的结合，在服务器端执行一次，用于实现服务器端渲染（首屏直出），在客户端再执行一次，用于接管页面交互(绑定事件)，核心解决 SEO 和首屏渲染慢的问题。采用同构思想的框架：Nuxt.js（基于 Vue）、Next.js（基于 React）。 |

![](https://gitee.com/alvin0216/cdn/raw/master/img/ssr/ssr-csr.png)

`CSR` 和 `SSR` 最大的区别在于前者的页面渲染是 `JS` 负责进行的，而后者是服务器端直接返回 `HTML` 让浏览器直接渲染。

## CSR（客户端渲染）

<img src='https://gitee.com/alvin0216/cdn/raw/master/img/ssr/csr.png' class='small' />

**渲染流程**：浏览器请求 url --> 服务器返回 index.html(空 body、白屏) --> 再次请求 bundle.js、路由分析 --> 浏览器渲染

bundle.js 体积越大，会导致浏览器白屏时间越长。

- 优点 交互友好，减少服务器压力。
- 缺点：
  - 由于页面显示过程要进行 JS 文件拉取，**首屏加载时间会比较慢**。
  - **对于 SEO 不友好**，因为搜索引擎爬虫只认识 html 结构的内容，而不能识别 JS 代码内容。

SSR 的出现，就是为了解决这些传统 CSR 的弊端。

## SSR

SSR 其实服务端返回 html 就已经算了，在这里讲的是结合 spa 的 ssr。

<img src='https://gitee.com/alvin0216/cdn/raw/master/img/ssr/ssr1.png' class='small' />
<img src='https://gitee.com/alvin0216/cdn/raw/master/img/ssr/ssr2.png' class='small' />

**渲染流程**：

- 阶段一：浏览器请求 url --> 服务器路由分析、执行渲染 --> 服务器返回 index.html(实时渲染的内容，字符串) --> 浏览器渲染
- 阶段二：浏览器请求 bundle.js --> 服务器返回 bundle.js --> 浏览器路由分析、生成虚拟 DOM --> 比较 DOM 变化、绑定事件 --> 二次渲染

尽管服务器渲染第一阶段的流程图很长，但是因为服务器渲染速度很快，因此实际耗时与客户端渲染几乎相同。

第一阶段结束时，服务器端返回渲染结果，用户即可看到首屏。而对于客户端渲染，需要等待一次脚本下载时间，以及在客户端的渲染时间。由于客户端的硬件以及网络条件的差异，这两段时间开销可能十分显著。

客户渲染与服务器渲染第二阶段基本一致。所不同的是，服务器渲染流程中，在客户端生成 vdom 后，并不会重新渲染，而是比较现有 dom 的 checksum 来决定是否重新渲染。

**原理**：基于 `Virtual DOM` 实现了客户端与服务端的同构渲染。

- 在服务器，我可以操作 JavaScript 对象，判断环境是服务器环境，我们把虚拟 DOM 映射成字符串输出；
- 在客户端，我也可以操作 JavaScript 对象，判断环境是客户端环境，我就直接将虚拟 DOM 映射成真实 DOM，完成页面挂载。

---

- [JS 核心理论之《SPA、CSR、SSR、Prerender 原理浅析》](https://zhuanlan.zhihu.com/p/138356519)
