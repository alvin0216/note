---
title: 进程和线程
date: 2020-06-11 22:59:47
---

<blockquote class='box'>

**进程和线程**

**进程**：启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程。

**线程**：线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率。

关系如图：

![](https://static001.geekbang.org/resource/image/33/da/3380f0a16c323deda5d3a300804b95da.png)

</blockquote>

使用多线程可以并行处理任务，大大提升性能。总结来说，进程和线程之间的关系有以下 4 个特点。

## 进程中的任意一线程执行出错，都会导致整个进程的崩溃

我们可以模拟以下场景：

```js
A = 1 + 2
B = 20 / 0
C = 7 * 8
```

在计算 B 的值的时候，我把表达式的分母改成 0，当线程执行到 B = 20/0 时，由于分母为 0，线程会执行出错，这样就会导致整个进程的崩溃，当然另外两个线程执行的结果也没有了。

## 线程之间共享进程中的数据

如下图所示，线程之间可以对进程的公共数据进行读写操作。

![](https://static001.geekbang.org/resource/image/d0/9e/d0efacd7f299ed99e776cb97da2a799e.png)

## 当一个进程关闭之后，操作系统会回收进程所占用的内存

当一个进程退出时，操作系统会回收该进程所申请的所有资源；即使其中任意线程因为操作不当导致内存泄漏，当进程退出时，这些内存也会被正确回收。

比如之前的 IE 浏览器，支持很多插件，而这些插件很容易导致内存泄漏，这意味着只要浏览器开着，内存占用就有可能会越来越多，但是当关闭浏览器进程时，这些内存就都会被系统回收掉。

## 进程之间的内容相互隔离

进程隔离是为保护操作系统中进程互不干扰的技术，每一个进程只能访问自己占有的数据，也就避免出现进程 A 写入数据到进程 B 的情况。正是因为进程之间的数据是严格隔离的，所以一个进程如果崩溃了，或者挂起了，是不会影响到其他进程的。如果进程之间需要进行数据的通信，这时候，就需要使用用于进程间通信（`IPC`）的机制了。
