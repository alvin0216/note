(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{764:function(t,s,e){"use strict";e.r(s);var a=e(7),v=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"半连接队列"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#半连接队列"}},[t._v("#")]),t._v(" 半连接队列")]),t._v(" "),e("p",[t._v("三次握手时，服务器第一次收到客户端的 SYN 之后，就会处于 SYN_RCVD 状态，此时双方还没有完全建立其连接，服务器会把此种状态下请求连接放在一个队列里，我们把这种队列称之为半连接队列。")]),t._v(" "),e("p",[t._v("当然还有一个全连接队列，就是已经完成三次握手，建立起连接的就会放在全连接队列中。如果队列满了就有可能会出现丢包现象。")]),t._v(" "),e("p",[t._v("这里在补充一点关于 "),e("strong",[t._v("SYN-ACK 重传次数")]),t._v("的问题：\n服务器发送完 "),e("code",[t._v("SYN-ACK")]),t._v(" 包，如果未收到客户确认包，服务器进行首次重传，等待一段时间仍未收到客户确认包，进行第二次重传。如果重传次数超过系统规定的最大重传次数，系统将该连接信息从半连接队列中删除。\n注意，每次重传等待的时间不一定相同，一般会是指数增长，例如间隔时间为 1s，2s，4s，8s......")]),t._v(" "),e("h2",{attrs:{id:"syn-攻击"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#syn-攻击"}},[t._v("#")]),t._v(" SYN 攻击")]),t._v(" "),e("p",[t._v("服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的，所以服务器容易受到 "),e("code",[t._v("SYN 洪泛攻击")]),t._v("。")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"title"},[t._v("SYN 攻击是一种典型的 DoS/DDoS 攻击。")]),e("p",[t._v("SYN 攻击就是 Client 在短时间内伪造大量不存在的 IP 地址，并向 Server 不断地发送 SYN 包，Server 则回复确认包，并等待 Client 确认，由于源地址不存在，因此 Server 需要不断重发直至超时，这些伪造的 SYN 包将长时间占用未连接队列，导致正常的 SYN 请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。")])]),e("p",[t._v("检测 SYN 攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源 IP 地址是随机的，基本上可以断定这是一次 SYN 攻击。在 "),e("code",[t._v("Linux/Unix")]),t._v(" 上可以使用系统自带的 "),e("code",[t._v("netstats")]),t._v(" 命令来检测 SYN 攻击。")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" -n -p TCP "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" SYN_RECV\n")])])]),e("p",[t._v("常见的防御 SYN 攻击的方法有如下几种：")]),t._v(" "),e("ul",[e("li",[t._v("缩短超时（SYN Timeout）时间")]),t._v(" "),e("li",[t._v("增加最大半连接数")]),t._v(" "),e("li",[t._v("过滤网关防护")]),t._v(" "),e("li",[t._v("SYN cookies 技术")])])])}),[],!1,null,null,null);s.default=v.exports}}]);